
<script type="text/template" id="stories-template">

  {{ stories.forEach(function (story) { }}

    {{ var storySlug = story.csp_story_path.match(/\/((\w|-)+)$/)[1]; }}
    {{ var customerSlug = story.csp_story_path.match(/^\/((\w|-)+)\//)[1]; }}

    <!-- // single quotes cause trouble -->
    {{ var summary = JSON.stringify(story.summary).replace(/'/g, "&#39"); }}
    {{ var quote = JSON.stringify(story.quote).replace(/'/g, "&#39"); }}

    <li class='grid-item' data-story-id="{{= story.id }}" data-story-slug="{{= storySlug }}" data-customer-slug="{{= customerSlug }}">

      <a href="{{= isCurator ? 'javascript:;' : (story.published && story.csp_story_path) || (story.preview_published && 'javascript:;') || '' }}"
         class="thumbnail {{= isCurator ? 'curator' : 'public' }} {{= story.published ? 'published' : (story.preview_published ? 'preview-published' : (story.logo_published ? 'logo-published' : 'pending-curation')) }} {{= story.title ? 'title-present' : '' }}"
         data-logosrc="{{= story.success.customer.logo_url }}"
         data-customer='{{= JSON.stringify(story.success.customer.name) }}'
         data-summary='{{= summary }}'
         data-quote='{{= quote }}'
         data-quote-attr-name='{{= JSON.stringify(story.quote_attr_name) }}'
         data-quote-attr-title='{{= JSON.stringify(story.quote_attr_title) }}'
         data-preview-contributor='{{= JSON.stringify(story.published_contributors[0]) }}'">

        <div class="thumbnail-view">

          {{ if (story.title) { }}
            <div class='thumbnail-view-hover'>
              <p>{{= story.title }}</p>
            </div>
          {{ } }}

          {{ if (story.success.customer.logo_url) { }}
            <img src="{{= story.success.customer.logo_url }}">
          {{ } else { }}
            <img src="<%= LOGO_PLACEHOLDER_URL %>">
          {{ } }}

        </div>

        <div class="caption">
          <span class="customer-name">{{= story.success.customer.name }}</span>
          <span class="click-action"></span>
        </div>

        <div class="still-loading-container">
          <i class="fa fa-spin fa-circle-o-notch"></i>
        </div>

      </a>

    </li>

  {{ }); }}

</script>
