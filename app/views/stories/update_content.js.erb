(function () {

  /*
   *  TODO: user-supplied html is scrubbed on input;
   *  should .sanitize also be called here?
   */
  var newContent = "<%= j @new_content.html_safe %>",
      $storyContentEditor = $('#story-content-editor'),
      $summernote = $storyContentEditor.next(),
      $formButtons = $("[form='story-content-form']"),
      $editor = $summernote.find('.note-editable'),
      $toolbarButtons = $summernote.find('.note-toolbar > .note-btn-group > button, .note-toolbar > .note-btn-group > .note-btn-group > button');

  /*
   *  we need to do this so that clicking 'Cancel' will go back to
   *  the very last saved value, NOT the value on initial page load
   *  (note: first one doesn't work!)
   */
  // $summernote('code', newContent);
  $storyContentEditor.html(newContent);

  $editor.attr('contenteditable', 'false')
         .css({
          'background-color': '#f5f5f5',
          'pointer-events': 'none'
         });

  $toolbarButtons.css({
                  'background-color': '#f5f5f5',
                  'pointer-events': 'none'
                 });

  $formButtons.addClass('hidden');

  $('#edit-story-content').css('color', '#666')
                          .css('pointer-events', 'auto');

}());