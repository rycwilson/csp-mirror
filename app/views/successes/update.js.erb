
(function () {

  var success = <%= raw @success.to_json({
        only: [:id, :name, :description],
        methods: [:display_status, :timestamp, :referrer, :contact],
        include: {
          curator: { only: [:id], methods: [:full_name] },
          customer: { only: [:id, :name, :slug] }
        }
      }) %>,
      $trSuccess = $('tr.shown[data-success-id="' + success.id + '"]'),
      $form = $('#success-form-' + success.id);

  toggleFormDone($form, true);

  // update datatables
  // don't update until the child row is closed, or the re-draw will hose things
  // timeout is necessary because this appears to step on the normal open/close behavior (success_details.js)
  $trSuccess.one('click', 'td.success-details', function (e) {
    setTimeout(function () {
      $('#successes-table').DataTable().row($trSuccess).data(success);
    }, 100);
  })

}());