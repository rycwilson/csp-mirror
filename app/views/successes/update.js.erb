
(function () {

  var success = <%= raw @success.to_json({ only: [:id, :win_story_completed] }) %>,
      winStoryCompleted = success.win_story_completed,
      $form = $('form[id*="success-form-"]'),
      $submitBtn = $form.find('button[type="submit"]'),
      isEditMode = typeof $('#win-story-editor').data('summernote') === 'object';

console.log(success.previous_changes)
  // toggle button icons
  $submitBtn.find('i.fa-spin, i.fa-check').toggle();

  setTimeout(function () {
    // re-enable items disabled during form submission
    $('td.toggle-success-child').removeClass('disabled');
    $('button.win-story-actions__edit').prop('disabled', false);

    $form.attr('data-submitted', '');
    if (isEditMode) {
      $submitBtn.find('.fa-check, .save-changes').toggle();
      $submitBtn.prop('disabled', true);
    } else {
      $submitBtn.removeClass('save-changes')
                .addClass('mark-completed')
                .find('.fa-check, .mark-completed').toggle();
      if (winStoryCompleted) $submitBtn.hide();
    }
  }, 2000)

  // maybe include sucess.win_story_udpated in the datatable
  // update datatables => not necessary as we're not keeping Success.win_story in datatables
  // don't update until the child row is closed, or the re-draw will hose things
  // timeout is necessary because this appears to step on the normal open/close behavior (success_child_row.js)
  // $trSuccess.one('click', 'td.toggle-success-child', function (e) {
  //   setTimeout(function () {
  //     $('#successes-table').DataTable().row($trSuccess).data(success);
  //   }, 100);
  // })

}());
