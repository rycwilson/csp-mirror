
(function () {

  var success = <%= raw @success.to_json(
          only: [:id], include: { contributions: { only: [:id] } }
        ) %>,
      reloadContributors = function () {
        $('#prospect-contributors-table').DataTable()
          .ajax.reload(function (contributions) {
            $('#prospect-contributors-table').closest('[id*="table_wrapper"]')
            .find('.curator-select').trigger('change')
          });
      }

  $('#successes-table').DataTable()
    .ajax.reload(function (successes) {
      var $trSuccess = $('tr[data-success-id="' + success.id + '"]'),
          openSuccessDetails = function () {
            $trSuccess.find('.success-details').trigger('click');
          },
          hideModal = function () {
            $('#new-success-modal').modal('hide');
          }

      // ref: https://stackoverflow.com/questions/6677035
      $('html, body').animate({ scrollTop: $trSuccess.offset().top - 80 }, 200)
        .promise().then(function () {
          openSuccessDetails();
          hideModal();
        });
    })

  if (success.contributions) {
    reloadContributors();
  }

}());