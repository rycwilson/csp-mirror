
<table id='measure-stories-table' width='100%'
       class="table table-striped table-bordered">

  <thead>
    <tr>
      <th>Customer</th>
      <th>Story title</th>
      <th>Publish date</th>
      <th>Unique visitors</th>
      <th>Total views</th>
      <th>Landing</th>
    </tr>
  </thead>

  <tbody>

    <tr>
      <td></td>
      <td><em>index</em></td>
      <td></td>
      <td><%= Visitor.company_index_visitors(company.id).count %></td>
      <td><%= PageView.company_index_views(company.id).count %></td>
      <td><%= "#{((PageView.company_index_views(company.id).count.to_f / company.page_views.count.to_f) * 100).round(1)}%" %></td>
    </tr>

    <% Story.includes(:customer, :page_views, :visitors)
            .company_published(company.id).each do |story| %>
            <!-- include :page_views results in error -->
      <tr>
        <td><%= story.customer.name %></td>
        <td><%= story.title %></td>
        <td><%= story.publish_date.strftime("%m/%d/%y") %></td>
        <td><%= story.visitors.uniq.count %></td>
        <td><%= story.page_views.count %></td>
        <td><%= "#{((story.page_views.count.to_f / company.page_views.count.to_f) * 100).round(1)}%" %></td>
      </tr>

    <% end %>

  </tbody>

</table>