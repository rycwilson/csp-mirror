
(function () {

  var contribution = <%= raw @contribution.to_json({ only: [:id] }) %>,
      contributor = <%= raw @contribution.contributor.to_json({
                      only: [:id, :first_name, :last_name, :linkedin_url],
                      methods: [:full_name, :previous_changes]
                    }) %>,
      $trContribution = $('tr[data-contribution-id="' + contribution.id + '"]'),
      $trContributor = $trContribution.next();

  // linkedin profile
  // .. removed
  if (contributor.previous_changes.linkedin_url && !contributor.linkedin_url) {
    $trContributor.find('.csp-widget-container').empty();
    $trContributor.find('.placeholder-widget-container').empty();
    $trContributor.find('.linkedin-widget-container').empty().addClass('hidden');
    $trContributor.find('.linkedin-profile').addClass('hidden');

  // ... added
  } else if (contributor.previous_changes.linkedin_url) {
    loadCspOrPlaceholderWidget($trContributor, contributor);
    loadLinkedinWidget($trContributor, contributor);
    $trContributor.find('.linkedin-profile').removeClass('hidden');
  }

  // update datatables
  $('#prospect-contributors-table, #curate-contributors-table').DataTable()
    .rows('[data-contributor-id="' + contributor.id + '"]')
    .every(function (rowIndex, tableLoop, rowLoop) {
      this.data( Object.assign(this.data(), { contributor: contributor }) )
    })

  toggleFormDone($('#contribution-form-' + contribution.id), true);

}());