
(function () {

  var contribution = <%= raw @contribution.to_json({
                           include: { contributor: { methods: [:previous_changes] } },
                           methods: [:previous_changes]
                         }) %>,
      $tr = $('tr[data-contribution-id="' + contribution.id.toString() + '"]').next(),
      updateAppData = function (contribution) {
        var cIndex = app.contributions.findIndex(function (c) {
          return c.id == contribution.id
        })
        for (attr in contribution.previous_changes) {
          app.contributions[cIndex][attr] = contribution[attr];
        }
        for (attr in contribution.contributor.previous_changes) {
          app.contributions[cIndex].contributor[attr] = contribution.contributor[attr];
        }
      };

  $tr.find('.fa-spinner, .fa-check').toggle();
  window.setTimeout(function () {
    $tr.find('.fa-check, span').toggle();
  }, 2000);

  updateAppData(contribution);

  if ( contribution.contributor.previous_changes.linkedin_url &&
       ( contribution.contributor.linkedin_url === '' ||
         contribution.contributor.linkedin_url === undefined ) ) {
    $tr.find('.csp-widget-container').empty();
    $tr.find('.placeholder-widget-container').empty();
    $tr.find('.linkedin-widget-container').empty().addClass('hidden');
    $tr.find('.linkedin-profile').addClass('hidden');

  } else if ( contribution.contributor.previous_changes.linkedin_url ) {
    loadCspOrPlaceholderWidget($tr, contribution);
    loadLinkedinWidget($tr, contribution);
    $tr.find('.linkedin-profile').removeClass('hidden');
  }

}());