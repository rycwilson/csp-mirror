
(function () {

  var contribution = <%= raw @contribution.to_json({ only: [:id, :publish_contributor] }) %>,
      contributor = <%= raw @contribution.contributor.to_json({
                      only: [:id, :first_name, :last_name, :email, :title],
                      methods: [:full_name, :previous_changes]
                    }) %>,
      $trContribution = $('tr.shown')
      $trContributor = $trContribution.next();
      rowData = $trContribution.closest('table').DataTable().row($trContribution).data();

  // linkedin profile
  // .. removed
  if (contributor.previous_changes.linkedin_url && !contributor.linkedin_url) {
    $trContributor.find('.csp-widget-container').empty();
    $trContributor.find('.placeholder-widget-container').empty();
    $trContributor.find('.linkedin-widget-container').empty().addClass('hidden');
    $trContributor.find('.linkedin-profile').addClass('hidden');

  // ... added
  } else if (contributor.previous_changes.linkedin_url) {
    loadCspOrPlaceholderWidget($trContributor, contributor);
    loadLinkedinWidget($trContributor, contributor);
    $trContributor.find('.linkedin-profile').removeClass('hidden');
  }

  delete contributor.previous_changes;

  // update datatables
  $('#prospect-contributors-table, #curate-contributors-table').DataTable()
    .row('[data-contribution-id="' + contribution.id + '"]')
      .data(
        Object.assign(rowData, { contributor: contributor }, { publish_contributor: contribution.publish_contributor })
      ).draw()

  toggleFormDone($('#contribution-form-' + contribution.id), true);

}());