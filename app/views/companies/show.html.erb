
<div id='wrapper'>

  <%= render 'shared/mvp_admin_navbar' %>

  <div ng-app="CspApp">
    <div ng-controller="MainCtrl" ng-init="tab = 1">
      <div class='mainnav'>

        <div class='container'>

          <a class="mainnav-toggle"
              data-toggle="collapse" data-target=".mainnav-collapse">
            <span class="sr-only">Toggle navigation</span>
            <i class="fa fa-bars"></i>
          </a>

          <nav class="collapse mainnav-collapse" role="navigation">

            <ul class="nav mainnav-menu">
              <li ng-class="{ active:tabSelected(1) }">
                <a ng-click="selectTab(1)"> Stories </a>
              </li>
              <li ng-class="{ active:tabSelected(2) }">
                <a ng-click="selectTab(2)"> Company Settings </a>
              </li>
              <li ng-class="{ active:tabSelected(3) }">
                <a ng-click="selectTab(3)"> Promote </a>
              </li>
              <li ng-class="{ active:tabSelected(4) }">
                <a ng-click="selectTab(4)"> Reporting </a>
              </li>
            </ul>
          </nav>

        </div>  <!-- container -->

      </div>  <!-- mainnav -->

      <div class="content" ng-show="tabSelected(1)">
        <div class='container'>

          <a href="javascript:;" class="btn btn-secondary"
              style="margin-top: -25px; margin-bottom: 14px">
            New story
          </a>&nbsp&nbsp&nbsp

          <!-- interesting! check server console -->
          <%# url_escaped_href = company_stories_path('{{ currentCompany.id }}')
              puts "*** #{url_escaped_href}"
              my_href = URI::unescape(url_escaped_href)
              puts "*** #{my_href}" %>
          <% url_escaped_href = company_stories_path('{{ currentCompany.id }}')
              my_href = URI::unescape(url_escaped_href) %>
          <a ng-href="<%= my_href %>" class="btn btn-secondary"
              style="margin-top: -25px; margin-bottom: 14px">
            Public stories index
          </a>

          <div class='row'>
            <div class='portlet portlet-default '>
              <div class='portlet-body'>
                <div class='table-responsive'>
                  <table class="table table-striped table-bordered thumbnail-table">
                    <thead>

                      <tr>
                        <th>Customer</th>
                        <th>Title</th>
                        <th>Publish Date</th>
                        <th>Status</th>
                        <th>Actions</th>
                      </tr>

                    </thead>
                    <tbody>
                      <tr ng-repeat="story in currentCompany.stories | orderBy:'created_at':true">

                        <td class="valign-middle">
                          {{ findCustomer(story.id) }}
                        </td>

                        <td class="valign-middle">
                          {{ story.title }}
                        </td>

                        <td class="valign-middle">
                          <!-- TODO: Story (or Success) needs a publish_date -->
                          <!-- dummy data for now -->
                          <%= Date.parse(FFaker::Time.date).strftime("%m/%d/%Y") %>
                        </td>

                        <td class="valign-middle">
                          <!-- TODO: Replace 'Pending' with actual status -->
                          <% url_escaped_href = story_path('{{ story.id }}')
                              my_href = URI::unescape(url_escaped_href) %>
                          <a ng-href="<%= my_href %>">
                            Pending Curation
                          </a>
                        </td>

                        <td class="text-center valign-middle">
                          <button class="btn btn-xs btn-primary">
                            <i class="fa fa-pencil"></i>
                          </button>&nbsp;
                          <button class="btn btn-xs btn-secondary">
                            <i class="fa fa-times"></i>
                          </button>
                        </td>

                      </tr>
                    </tbody>
                  </table>
                </div>  <!-- table-responsive -->
              </div>  <!-- portlet-body -->
            </div>  <!-- portlet -->
          </div>  <!-- row -->
        </div>  <!-- container -->
      </div>  <!-- content -->
      <div class='content' ng-show="tabSelected(2)">
        <div class='container'>
          <div class='row'>
            <div class='portlet portlet-default'>
              <div class='portlet-body'>
                Settings
              </div>
            </div>
          </div>  <!-- row -->
        </div>  <!-- container -->
      </div>  <!-- content -->
      <div class='content' ng-show="tabSelected(3)">
        <div class='container'>
          <div class='row'>
            <div class='portlet portlet-default'>
              <div class='portlet-body'>
                Promote
              </div>
            </div>
          </div>  <!-- row -->
        </div>  <!-- container -->
      </div>  <!-- content -->
      <div class='content' ng-show="tabSelected(4)">
        <div class='container'>
          <div class='row'>
            <div class='portlet portlet-default'>
              <div class='portlet-body'>
                Reporting
              </div>
            </div>
          </div>  <!-- row -->
        </div>  <!-- container -->
      </div>  <!-- content -->
    </div>  <!-- MainCtrl -->
  </div>  <!-- CspApp -->
</div>  <!-- wrapper -->
