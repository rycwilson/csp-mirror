(function () {

  var company = <%= raw @company.to_json({
                  only: [],
                  methods: [:header_color_1_changed?, :header_color_2_changed?, :color_contrast]
                }) %>,
      isProfileUpdate = $('[href="#company-profile"]').parent().hasClass('active'),
      isTagsUpdate = $('[href="#story-tags"]').parent().hasClass('active'),
      toggleProfileSubmit = function () {
        $('#company-profile-form button[type="submit"]').find('span, .fa-spin').toggle();
      },
      toggleProfileForm = function () {
        $('#company-profile-form').data('submitted', '');
      };

  if (isProfileUpdate) {
    toggleProfileSubmit();

    if (company['header_color_1_changed?']) {
      $('.admin.navbar').css({ background: company.header_color_1 })
    }
    if (company['header_color_2_changed?']) {
      $('#stories-header')
        .css({ background: company.header_color_2 })
        .find('h3, .icon-button').removeClass('light dark').addClass(company.color_contrast)
    }

    $('#company-profile-form .logo-upload .thumbnail').css('background', '<%= @company.header_color_1 %>');
    flashDisplay('<%= @flash_mesg %>', '<%= @flash_status %>', toggleProfileForm);

  } else if (isTagsUpdate) {
    toggleFormDone($('#company-tags-form'), true)
  }

}());