<!-- curate -->
<div id='curate' class='tab-pane content active' role='tabpanel'>
  <div class='container'>

    <!-- new story modal -->
    <button type="button" class="btn btn-secondary"
        style='margin-top: -25px; margin-bottom: 14px'
        data-toggle="modal" data-target="#new-story-modal">
      New story
    </button>

    <%= link_to 'Public stories index', company_stories_path(@company),
        { class: 'btn btn-secondary',
          style: 'margin-top: -25px; margin-bottom: 14px' } %>

    <div class='row'>
      <div class='portlet portlet-default '>
        <div class='portlet-body'>
          <div class='table-responsive'>

            <table class="table table-striped table-bordered thumbnail-table">
              <thead>
                <tr>
                  <th>Customer</th>
                  <th>Title</th>
                  <th>Publish Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>

                <% @company.stories.each do |story| %>

                  <tr>
                    <td class='valign-middle'>
                      <%= story.success.customer.name %>
                    </td>
                    <td class='valign-middle'>
                      <%= story.title %>
                    </td>
                    <td class='valign-middle'>
                      <%= story.success.publish_date.strftime('%m/%d/%Y') %>
                    </td>
                    <td class='valign-middle'>
                      <%= link_to 'Pending curation', story_path(story) %>
                    </td>
                    <td class="text-center class='valign-middle'">
                      <%= link_to edit_story_path(story),
                          class: "btn btn-xs btn-primary" do %>
                        <i class="fa fa-pencil"></i>
                      <% end %>
                      <%= link_to story_path(story),
                          method: 'delete',
                          data: { confirm: 'Are you sure?' },
                          class: 'btn btn-xs btn-secondary' do %>
                        <i class="fa fa-times"></i>
                      <% end %>
                    </td>
                  </tr>

                <% end %>

              </tbody>
            </table>
          </div>  <!-- table-responsive -->
        </div>  <!-- portlet-body -->
      </div>  <!-- portlet -->
    </div>  <!-- row -->
  </div>  <!-- container -->
</div>  <!-- curate -->

<!-- new story modal -->
<!-- NOTE tabIndex = -1 must be removed for select2 to work in the modal -->
<div class="modal fade" id="new-story-modal" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">New Customer Story</h4>
      </div>
      <div class="modal-body">

        <!-- Note: all form inputs name-spaced under 'story' -->
        <%= form_tag company_stories_path(@company), class: 'form-horizontal' do %>

          <div class='form-group required-input'>
            <%= label_tag 'Customer', nil, class: 'col-md-4 control-label' %>
            <div class='col-md-8'>

              <% if @customers_select.length == 1 %>

                <%= text_field_tag 'story[customer]', nil,
                  class: 'form-control',
                  style: 'width: 100%', autofocus: 'true',
                  placeholder: 'add a customer' %>

              <% else %>

                <%= select_tag 'story[customer]',
                    options_for_select(@customers_select),
                    class: 'new-story-customer form-control',
                    style: 'width: 100%' %>

              <% end %>

            </div>
          </div>

          <div class='form-group required-input'>
            <%= label_tag 'Story title', nil, class: 'col-md-4 control-label' %>
            <div class='col-md-8'>
              <%= text_field_tag 'story[title]', nil, class: 'form-control',
                  placeholder: 'title' %>
            </div>
          </div>

          <div class="form-group">
            <%= label_tag 'Industry tags', nil,
                class: 'col-md-4 control-label' %>
            <div class='col-md-8'>
              <!-- Note the necessary '[]' notation below  -->
              <!-- if not present, will only return a single value  -->
              <%= select_tag "story[industry_tags][]",
                  options_for_select(@industries_select),
                  { multiple: 'true', class: 'new-story-tags form-control',
                    style: 'width:100%'} %>
            </div>
          </div>

          <div class="form-group">
            <%= label_tag 'Product Category tags', nil,
                class: 'col-md-4 control-label' %>
            <div class='col-md-8'>
              <%= select_tag "story[product_cat_tags][]",
                  options_for_select(@product_cats_select),
                  { multiple: 'true', class: 'new-story-tags form-control',
                    style: 'width:100%'} %>
            </div>
          </div>

          <div class="form-group">
            <%= label_tag 'Product tags', nil, class: 'col-md-4 control-label' %>
            <div class='col-md-8'>
              <%= select_tag "story[product_tags][]",
                  options_for_select(@products_select),
                  { multiple: 'true', class: 'new-story-tags form-control',
                    style: 'width:100%'} %>
            </div>
          </div>

      </div>
      <div class="modal-footer">

        <button class="btn btn-default" data-dismiss="modal">
          Cancel
        </button>

          <%= submit_tag 'Create Story', class: 'btn btn-primary' %>

        <% end %>  <!-- form_for -->

      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal