
(function () {

  var resData = <%= raw @response_data.to_json %>,
      $table = $('#promoted-stories-table'),
      $row = $table.find('[data-story-id="' + resData.promotedStory.id + '"]'),
      dt = $table.DataTable(),
      dtRow = dt.row('[data-story-id="' + resData.promotedStory.id + '"]'),
      isStatusUpdate = resData.previousChanges && (resData.previousChanges[0] === 'status');
  console.log('resData', resData);

  if (resData.isImagesUpdate) {
    toggleFormDone($('#ads-images-form'), false);
    $('#ads-images-modal').modal('hide');

  } else if (isStatusUpdate) {
    var $switchContainer = (
          $table.find('tr[data-story-id="' + resData.promotedStory.id + '"] .bootstrap-switch-container')
        ),
        prevStatus = resData.previousChanges[1][0],
        newStatus = resData.previousChanges[1][1];

    if (resData.errors){
      // return to previous state
    } else {
      $switchContainer
        .find(newStatus === 'ENABLED' ? '.bootstrap-switch-handle-on' : '.bootstrap-switch-handle-off')
        .find('.fa-spin, .fa-check').toggle();
      setTimeout(function () {
        dtRow.data(resData.promotedStory);
        $switchContainer.closest('form')
                        .attr('data-submitted', '');
        $row.find('.bs-switch.promote-control').bootstrapSwitch({ size: 'small' });
      }, 2000)

    }
  }

  if (resData.errors) {
    flashDisplay(errors[0], 'danger')
  } else {
    // flashDisplay('Promoted Story updated successfully', 'success');
  }

}());