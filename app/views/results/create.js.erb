(function () {

  var results = <%= raw @results.to_json %>,
      storyId = <%= @story_id %>,
      baseUrl = "<%= @base_url %>"
     template = _.template($('#results-template').html()),
   flashError = "<%= @flash_error %>" || null;

  if (!flashError) {
    $('#results-list').empty();
    results.forEach(function (result, index) {
      $('#results-list').append(template({ result: result,
                                            index: index,
                                          storyId: storyId,
                                          baseUrl: baseUrl }));
    });
    // dynamically added elements must be reset as bip elements
    $('.best_in_place').best_in_place();
    $('#new-result').val('');
    $('#new-result').parent().find('button').blur();
  } else {
    flashDisplay(flashError, 'danger')
    $('#new-result').parent().find('button').blur();
    $('#new-result').focus();
  }

}());